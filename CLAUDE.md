# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

**Competency Manager (CM)** — A competency management platform for Product Designer roles. Tracks competencies across levels (Associate → Intermediate → Senior → Lead → Principal), manages team assessments, hiring pipelines, and generates AI-powered promotion plans.

**Live site**: https://competencies-app.netlify.app

## Domain Context

This app is a design management tool used by a design leader to evaluate and assess the skills of Product Designers on their team. The primary user is the manager; team members and other stakeholders may have viewer access.

### Competency Framework

The foundation of the app is a structured competency framework. Each **competency** (e.g., "Visual Design", "User Research") contains **sub-competencies**, and each sub-competency defines detailed criteria at five career levels: Associate, Intermediate, Senior, Lead, and Principal. This framework is the single source of truth for what "good" looks like at every level — it makes expectations explicit and evaluation consistent.

### Team Assessments

The manager uses the framework to periodically assess each team member against the criteria for their current level and the next level up. Assessments produce a clear picture of where each person stands, what skills they've grown, and where gaps remain. Over time, multiple assessments reveal trends — whether someone is improving, plateauing, or declining in specific competencies. AI-generated promotion plans use this assessment data to create actionable development roadmaps.

### Team Skill Mapping

The team-level view aggregates individual assessments into a skill map, showing the overall team's strengths and weaknesses across all competencies. This helps the manager understand the collective capability of the team and identify which skills are well-covered and which are thin.

### Hiring Assessments

The same competency framework is applied to evaluate candidates during the hiring process. Candidates go through assessment stages (competency evaluation, manager interview, portfolio review), each scored against the same criteria used for team members. This ensures hiring decisions are grounded in the same standards and directly informed by the team's skill gaps — the manager can prioritize candidates who complement the existing team's capabilities.

### Design Principles

The app should provide an intuitive, efficient way to accurately assess both team members and potential hires. Every feature should serve the goal of making skill evaluation clearer, faster, and more actionable. Avoid complexity that doesn't directly support assessment accuracy or decision-making.

## Build & Development Commands

```sh
# Development (requires two terminals)
npx convex dev          # Terminal 1: Convex backend (syncs functions + generates types)
npm run dev             # Terminal 2: Vite frontend on localhost:8080

# Production build
npm run build           # Vite build → dist/

# Lint
npm run lint            # ESLint
```

There are no tests configured in this project.

## Architecture

### Provider Chain

`main.tsx` sets up the provider hierarchy: `ClerkProvider` → `ConvexProviderWithClerk` → `App`. Clerk handles authentication, Convex handles data. The `ConvexProviderWithClerk` bridge (from `convex/react-clerk`) passes Clerk's auth token to Convex automatically.

### Auth Flow

`AppLayout` in `App.tsx` wraps all authenticated routes. It uses the custom `useAuth()` hook (`src/hooks/useAuth.tsx`) which combines Clerk's `useUser()` with a Convex `users` table query. On first sign-in, `ensureUser` mutation auto-creates the Convex user record. Roles (`admin`/`editor`/`viewer`) are stored in the Convex `users` table, not in Clerk. The `isAdmin` check gates UI features like adding team members or generating plans.

### Data Layer (Convex)

All data lives in Convex. Frontend components use `useQuery()` for reactive reads, `useMutation()` for writes, and `useAction()` for server-side operations that call external APIs (OpenAI). Functions are referenced as `api.module.functionName` — types are auto-generated by `npx convex dev` into `convex/_generated/`.

The imperative client is `useConvex()` from `convex/react` (not `useConvexClient` — that doesn't exist in this Convex version).

Convex actions requiring Node.js APIs (like the OpenAI SDK in `convex/ai.ts`) must have `"use node"` at the top of the file.

### Data Model Relationships

The core data flows through these relationships:
- `competencies` → `subCompetencies` (each competency has level-specific criteria arrays: `associateLevel`, `intermediateLevel`, etc.)
- `teamMembers` → `assessments` → `memberCompetencyProgress` → `criteriaEvaluations` (assessment drill-down)
- `hiringCandidates` → `candidateAssessments` → `candidateCompetencyProgress` → `candidateCriteriaEvaluations` (parallel hiring track)
- `teamMembers` → `promotionPlans` (AI-generated via `convex/ai.ts`)

Criteria evaluations use a 5-point scale: `well_below` (1), `below` (2), `target` (3), `above` (4), `well_above` (5).

### Key Conventions

- **Document IDs**: Always `_id` (Convex convention), never `id`. References use `v.id("tableName")`.
- **Field naming**: camelCase everywhere (e.g., `orderIndex`, `competencyId`, `associateLevel`).
- **Path alias**: `@` maps to `src/` — use `@/components/...`, `@/hooks/...`, etc.
- **UI components**: shadcn/ui in `src/components/ui/`. Feature components directly in `src/components/`.
- **Theme**: Dark theme only (`defaultTheme="dark"` in ThemeProvider).

## Environment Variables

**Local `.env`**:
- `VITE_CONVEX_URL` — Convex deployment URL
- `VITE_CLERK_PUBLISHABLE_KEY` — Clerk publishable key

**Convex Dashboard (server-side)**:
- `CLERK_JWT_ISSUER_DOMAIN` — Clerk issuer domain (used in `convex/auth.config.ts`)
- `OPENAI_API_KEY` — Used by `convex/ai.ts` for promotion plan generation

## Deployment

Pushes to `main` auto-deploy the frontend to Netlify. Convex functions deploy separately via `npx convex deploy` (production) or sync automatically when `npx convex dev` is running.
